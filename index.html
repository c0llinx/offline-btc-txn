<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Bitcoin Transaction Workflow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #0d6efd;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .network-status {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .network-status.healthy {
            background-color: #d4edda;
            color: #155724;
        }

        .network-status.unhealthy {
            background-color: #f8d7da;
            color: #721c24;
        }

        .warning-box {
            background-color: #fff3cd;
            color: #856404;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
        }

        .calculator-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .funding-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }

        .section-title {
            color: #0d6efd;
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 10px;
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .input-group label {
            min-width: 100px;
            font-weight: bold;
        }

        input[type="number"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #0d6efd;
        }

        .operations {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .op-btn {
            background-color: #0d6efd;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 60px;
        }

        .op-btn:hover {
            background-color: #0b5ed7;
            transform: translateY(-2px);
        }

        .op-btn.selected {
            background-color: #0a58ca;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background-color: #218838;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .calc-btn {
            background-color: #28a745;
            color: white;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calc-btn:hover:not(:disabled) {
            background-color: #218838;
            transform: translateY(-2px);
        }

        .calc-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .address-display {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            word-break: break-all;
            border: 1px solid #dee2e6;
            margin: 10px 0;
        }

        .funding-status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }

        .funding-status.success {
            background-color: #d4edda;
            color: #155724;
        }

        .funding-status.warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .funding-status.error {
            background-color: #f8d7da;
            color: #721c24;
        }

        .funding-status.info {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .faucet-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .faucet-link {
            background: #007bff;
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 5px;
            text-align: center;
            transition: background-color 0.3s;
        }

        .faucet-link:hover {
            background: #0056b3;
            color: white;
        }

        .saved-addresses-list {
            display: grid;
            gap: 15px;
        }

        .saved-address-item {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .saved-address-item:hover {
            border-color: #0d6efd;
            background: #fff8f0;
        }

        .saved-address-item.selected {
            border-color: #0d6efd;
            background: #fff8f0;
            box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.2);
        }

        .saved-address-item.matching {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .saved-address-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .saved-address-calculation {
            font-size: 1.1rem;
            font-weight: bold;
            color: #0d6efd;
        }

        .saved-address-balance {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .saved-address-balance.funded {
            background: #d4edda;
            color: #155724;
        }

        .saved-address-balance.unfunded {
            background: #f8d7da;
            color: #721c24;
        }

        .saved-address-details {
            font-family: monospace;
            font-size: 0.85rem;
            color: #666;
        }

        .address-info {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .results {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }

        .result-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #0d6efd;
        }

        .result-label {
            font-weight: bold;
            color: #666;
            margin-bottom: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-family: monospace;
            word-break: break-all;
            padding: 10px;
            background: white;
            border-radius: 3px;
            border: 1px solid #dee2e6;
        }

        .result-value.large-text {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .tx-link {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .tx-link:hover {
            text-decoration: underline;
        }

        .broadcast-status {
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .broadcast-status.success {
            background-color: #d4edda;
            color: #155724;
        }

        .broadcast-status.failed {
            background-color: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            display: none;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
            border-left: 4px solid #dc3545;
        }

        .status-text {
            text-align: center;
            margin: 10px 0;
            font-style: italic;
            color: #666;
            display: none;
        }

        .instructions {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 5px;
            margin: 15px 0;
            white-space: pre-line;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .operations {
                flex-wrap: wrap;
            }

            .button-group {
                flex-direction: column;
            }

            .faucet-links {
                grid-template-columns: 1fr;
            }
        }
      .results-hidden { display:none; }
  .form-hidden { display:none; }
  /* Hide legacy arithmetic UI */
  .calculator-section, #saved-addresses-section, #funding-section { display:none !important; }
        /* Toast Notifications */
        #toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 9999;
            pointer-events: none;
        }
        #toast.show {
            opacity: 0.95;
        }
</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Offline Bitcoin Transactions</h1>
            <p class="subtitle">Air-gapped Taproot workflow: create, claim, and refund securely via QR codes</p>
        </div>

        <div id="network-status" class="network-status">Checking network status...</div>

        <div class="warning-box">
            <strong>⚠️ REAL BITCOIN TESTNET MODE</strong><br>
            This application creates actual Bitcoin testnet transactions that will be broadcast to the Bitcoin network. 
            Testnet Bitcoin has no monetary value but requires real network interaction. 
            Make sure you understand the process before proceeding.
        </div>

        <div class="calculator-section">
            <h2 class="section-title">🧮 Arithmetic Calculation</h2>
            
            <div class="input-group">
                <label>Number 1:</label>
                <input type="number" id="num1" value="10" step="1">
            </div>
            
            <div class="input-group">
                <label>Number 2:</label>
                <input type="number" id="num2" value="5" step="1">
            </div>
            
            <div class="operations">
                <button class="op-btn" data-op="add">+</button>
                <button class="op-btn" data-op="subtract">−</button>
                <button class="op-btn" data-op="multiply">×</button>
                <button class="op-btn" data-op="divide">÷</button>
            </div>

            <div id="calculation-status" class="status-text"></div>
            
            <div class="button-group">
                <button class="btn btn-secondary" id="generateAddressBtn">Generate Funding Address</button>
                <button class="calc-btn" id="calculateBtn" disabled>Calculate & Create Real Transaction</button>
            </div>
        </div>

        <div id="saved-addresses-section" class="funding-section">
            <h2 class="section-title">💾 Saved Addresses</h2>
            <div id="saved-addresses-list" class="saved-addresses-list">
                Loading saved addresses...
            </div>
        </div>

        <div id="funding-section" class="funding-section">
            <h2 class="section-title">💰 Funding Required</h2>
            
            <div id="address-info" class="address-info">
                <p><strong>Your Taproot Address for this calculation:</strong></p>
                <div class="address-display" id="funding-address">
                    Click "Generate Funding Address" to create an address...
                </div>
                
                <div id="funding-status" class="funding-status info">
                    Waiting for address generation...
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="checkFundingBtn">Check Funding Status</button>
                </div>
            </div>
            
            <h3>🪙 Get Testnet Bitcoin</h3>
            <p>Send at least 100,000 satoshis (0.001 tBTC) to the address above from these faucets:</p>
            
            <div class="faucet-links">
                <a href="https://testnet-faucet.mempool.co/" target="_blank" class="faucet-link">Mempool.co Faucet</a>
                <a href="https://bitcoinfaucet.uo1.net/" target="_blank" class="faucet-link">BitcoinFaucet.uo1.net</a>
                <a href="https://testnet.help/en/btcfaucet/testnet" target="_blank" class="faucet-link">Testnet.help</a>
                <a href="https://coinfaucet.eu/en/btc-testnet/" target="_blank" class="faucet-link">CoinFaucet.eu</a>
            </div>

            <div id="funding-instructions" class="instructions">
                Detailed funding instructions will appear here...
            </div>
        </div>

        <!-- Offline Taproot Workflow UI -->
<h2 class="section-title">⚡ Offline Taproot Workflow</h2>
<ul class="operations" style="justify-content:flex-start;">
  <li id="tab-sender" class="op-btn tab-link">Sender</li>
  <li id="tab-receiver" class="op-btn tab-link">Receiver</li>
  <li id="tab-refund" class="op-btn tab-link">Refund</li>
</ul>
<div id="loading" class="loading" style="display:none;">Loading...</div>
<div id="error" class="error" style="display:none;"></div>
<div id="section-sender" class="funding-section">
  <form id="sender-form">
    <div class="input-group"><label>Sender WIF:</label><input type="text" id="sender-wif-input" name="sender-wif" required style="flex:1;"><button type="button" class="btn btn-secondary" id="generate-sender-wif-btn" style="margin-left:10px;">Generate</button></div>
    <div class="input-group"><label>Receiver PubKey (hex):</label><input type="text" name="receiver-address" required></div>
    <div class="input-group"><label>Amount (sats):</label><input type="number" name="amount" value="50000" min="1000" required></div>
    <div class="input-group"><label>Refund Timelock (block):</label><input type="number" name="refund-locktime" value="1700000" required></div>
    <button class="btn btn-primary" type="submit">Create Funding PSBT</button>
  </form>
  <div id="sender-results" class="results-hidden" style="margin-top:20px;">
    <h3>QR Code A (Tx Data)</h3><div id="qrcode-a"></div>
    <h3>QR Code B (Secret)</h3><div id="qrcode-b"></div>
  </div>
</div>
<div id="section-receiver" class="funding-section" style="display:none;">
  <button class="btn btn-primary" id="start-receiver-scan-btn">Start Scan</button>
  <button class="btn btn-secondary" id="paste-tx-btn" style="margin-left:10px;">Paste Tx Data</button>
  <button class="btn btn-secondary" id="paste-secret-btn" style="margin-left:10px;">Paste Secret</button><button type="button" class="btn btn-secondary" id="generate-receiver-wif-btn" style="margin-left:10px;">Generate Receiver Key</button><div id="receiver-generated-address" style="margin-top:10px; font-family:monospace;"></div>
  <div id="receiver-scanner-div" style="margin-top:10px;"></div>
  <form id="receiver-form" class="form-hidden">
    <div class="input-group"><label>Receiver WIF:</label><input type="text" id="receiver-wif-input" name="receiver-wif" required style="flex:1;"></div>
    <button class="btn btn-primary" type="submit">Create Claim PSBT</button>
  </form>
</div>
<div id="section-refund" class="funding-section" style="display:none;">
  <button class="btn btn-primary" id="start-refund-scan-btn">Start Scan</button>
  <div id="refund-scanner-div" style="margin-top:10px;"></div>
  <form id="refund-form" class="form-hidden">
    <div class="input-group"><label>Sender WIF:</label><input type="text" id="sender-wif-input" name="sender-wif" required style="flex:1;"><button type="button" class="btn btn-secondary" id="generate-sender-wif-btn" style="margin-left:10px;">Generate</button></div>
    <button class="btn btn-primary" type="submit">Create Refund PSBT</button>
  </form>
</div>
<div id="results" class="results">
            <h2 class="section-title">📊 Transaction Results</h2>
            
            <div class="result-item">
                <div class="result-label">Operation</div>
                <div class="result-value large-text" id="operation"></div>
            </div>
            
            <div class="result-item">
                <div class="result-label">Result</div>

  <script>
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tab-link");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }
    // Initialize the first tab
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementsByClassName('tab-link')[0].click();
    });
  </script>
  <script type="module" src="/src/client/app.ts"></script>
    <div id="toast"></div>
</body>
</html>